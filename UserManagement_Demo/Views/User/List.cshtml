@model UserManagement_Demo.DTOs.PagedResult<UserManagement_Demo.DTOs.UserDTO>

@{
    ViewData["Title"] = "User List";
    int totalPages = (int)Math.Ceiling((double)Model.TotalRecords / Model.PageSize);
    int currentPage = Model.PageIndex;
}

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />

<div class="container mt-4">
    <h2 class="mb-4 text-primary">User List</h2>

    <!-- Search Form -->
    <form method="get" asp-action="List" class="row g-3 mb-4 align-items-end bg-light p-3 rounded shadow-sm">
        <div class="col-md-3">
            <label class="form-label fw-semibold">Keyword</label>
            <input type="text" name="Keyword" value="@Context.Request.Query["Keyword"]"
                   class="form-control" placeholder="Search by name, email, phone or address..." />
        </div>

        <div class="col-md-3">
            <label class="form-label fw-semibold">DOB From</label>
            <input type="date" name="DobFrom" value="@Context.Request.Query["DobFrom"]"
                   class="form-control" />
        </div>

        <div class="col-md-3">
            <label class="form-label fw-semibold">DOB To</label>
            <input type="date" name="DobTo" value="@Context.Request.Query["DobTo"]"
                   class="form-control" />
        </div>

        <div class="col-md-3 d-flex gap-2">
            <button type="submit" class="btn btn-primary flex-fill">
                Search
            </button>
            <a href="@Url.Action("List")" class="btn btn-secondary flex-fill">
                Clear
            </a>
        </div>
    </form>

    <a class="btn btn-primary px-4 py-2" href="/User/Add">
        <i class="bi bi-plus-circle"></i> Add User
    </a>

    <!-- Table -->
    @if (Model.Items.Any())
    {
        <table class="table table-bordered table-striped align-middle shadow-sm">
            <thead class="table-light">
                <tr>
                    <th style="width: 50px;">#</th>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Address</th>
                    <th>Date of Birth</th>
                    <th style="width: 100px;">Action</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var user in Model.Items)
                {
                    <tr>
                        <td>@user.UserId</td>
                        <td>@user.FullName</td>
                        <td>@user.Email</td>
                        <td>@user.Phone</td>
                        <td>@user.Address</td>
                        <td>@(user.Dob.ToString("dd/MM/yyyy"))</td>
                        <td class="d-flex gap-1">
                            <a class="btn btn-secondary btn-sm" href="/User/Edit/@user.UserId">
                                <i class="bi bi-pencil-square"></i>
                            </a>
                            <a href="@Url.Action("Delete", "User", new { id = user.UserId })" class="btn btn-danger btn-sm" 
                               onclick="return confirm('Are you sure you want to delete this user?');">
                                <i class="bi bi-trash"></i>
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>

        <!-- Pagination -->
        @if (totalPages > 1)
        {
            <nav>
                <ul class="pagination justify-content-center">
                    <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                        <a class="page-link"
                           href="@Url.Action("List", new { Keyword = Context.Request.Query["Keyword"], DobFrom = Context.Request.Query["DobFrom"], DobTo = Context.Request.Query["DobTo"], PageIndex = currentPage - 1, PageSize = Model.PageSize })">
                            Previous
                        </a>
                    </li>

                    @for (int i = 1; i <= totalPages; i++)
                    {
                        <li class="page-item @(i == currentPage ? "active" : "")">
                            <a class="page-link"
                               href="@Url.Action("List", new { Keyword = Context.Request.Query["Keyword"], DobFrom = Context.Request.Query["DobFrom"], DobTo = Context.Request.Query["DobTo"], PageIndex = i, PageSize = Model.PageSize })">
                                @i
                            </a>
                        </li>
                    }

                    <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                        <a class="page-link"
                           href="@Url.Action("List", new { Keyword = Context.Request.Query["Keyword"], DobFrom = Context.Request.Query["DobFrom"], DobTo = Context.Request.Query["DobTo"], PageIndex = currentPage + 1, PageSize = Model.PageSize })">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>
        }

        <div class="text-muted small text-end">
            Showing @(((Model.PageIndex - 1) * Model.PageSize) + 1)
            -
            @(Math.Min(Model.PageIndex * Model.PageSize, Model.TotalRecords))
            of @Model.TotalRecords records
        </div>
    }
    else
    {
        <div class="alert alert-info">No users found.</div>
    }

    <div class="container mt-3">
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                @TempData["ErrorMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        }
    </div>


</div>


